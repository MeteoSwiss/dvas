<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Creating dvas recipes &mdash; dvas  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Troubleshooting" href="troubleshooting.html" />
    <link rel="prev" title="Running dvas recipes" href="running_recipes.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> dvas
          </a>
              <div class="version">
                0.5.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="running_recipes.html">Running dvas recipes</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Creating dvas recipes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#naming-conventions">Naming conventions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#protected-tag-names">Protected tag names</a></li>
<li class="toctree-l3"><a class="reference internal" href="#default-database-variable-names">Default database variable names</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parameter-names">Parameter names</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#event-filtering-syntax">Event filtering syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plotting-tools">Plotting tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledge.html">Acknowledging dvas</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License &amp; Copyright</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/MeteoSwiss-MDA/dvas/blob/develop/CONTRIBUTING.md">Contributing</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/MeteoSwiss-MDA/dvas">Github repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="doc_todo.html">Documentation todos</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">dvas</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Creating dvas recipes</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/creating_recipes.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="creating-dvas-recipes">
<span id="creating"></span><h1>Creating dvas recipes<a class="headerlink" href="#creating-dvas-recipes" title="Permalink to this headline"></a></h1>
<p>This page contains information for advanced dvas users that would like to alter existing
processing recipes, or create their own.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>If you plan on coding with dvas, we strongly suggest that you begin by taking a look at the
<a class="reference external" href="https://github.com/MeteoSwiss/dvas/blob/develop/CONTRIBUTING.md">contributing guidelines</a>
on Github. Even if you do not want to share your modifications (which is totally fine !), these
guidelines contain critical information regarding the structure and spirit of the code.</p>
</div>
<p>Assuming that you have initialized a new dvas processing arena using the <code class="docutils literal notranslate"><span class="pre">dvas_init_arena</span></code> entry
point, take a look at <code class="docutils literal notranslate"><span class="pre">demo_script.py</span></code>. This Python script, which we suggest you run from inside
a Python shell (using <code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">demo_script.py</span></code>), illustrates the main functions and tools of the core
dvas sub-package. It is therefore an excellent place to familiarize yourself with the dvas spirit.</p>
<p>** AND NOW FOR A BIG PILE OF IMPORTANT INFO THAT NEEDS TO BE SORTED …**</p>
<section id="naming-conventions">
<h2>Naming conventions<a class="headerlink" href="#naming-conventions" title="Permalink to this headline"></a></h2>
<section id="protected-tag-names">
<h3>Protected tag names<a class="headerlink" href="#protected-tag-names" title="Permalink to this headline"></a></h3>
<p>The following tag names are used by dvas, and thus protected. They are defined in
<cite>dvas/config/definitions/tag.py</cite>:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">raw</span></code>:</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gdp</span></code>:</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">derived</span></code>:</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">empty</span></code>:</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sync</span></code>:</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1s</span></code>:</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">resampled</span></code>:</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delta</span></code>:</p></li>
</ul>
</div></blockquote>
</section>
<section id="default-database-variable-names">
<h3>Default database variable names<a class="headerlink" href="#default-database-variable-names" title="Permalink to this headline"></a></h3>
<p>The following names can be altered by the users in the different config files. These are the ones
implemented by defaults. They follow MeteoSwiss conventions:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">time</span></code>: time since launch</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gph</span></code>: geopotential height</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">temp</span></code>: temperature</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rh</span></code>: relative humidty</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pres</span></code>: pressure</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wdir</span></code>: wind direction</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wspeed</span></code>: wind speed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xxx_ucr</span></code>: rig-uncorrelated uncertainty of xxx</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xxx_ucs</span></code>: spatial-correlated uncertainty of xxx</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xxx_uct</span></code>: temporal-correlated uncertainty of xxx</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xxx_ucu</span></code>: true uncorrelated uncertainty of xxx</p></li>
</ul>
</div></blockquote>
</section>
<section id="parameter-names">
<h3>Parameter names<a class="headerlink" href="#parameter-names" title="Permalink to this headline"></a></h3>
<p>For instances of <cite>Profile</cite>, <cite>MultiProfile</cite>, and their children, the following parameter (<cite>prm</cite>)
names are applicable (as defined in <cite>dvas.hardcoded</cite>):</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">val</span></code>: primary Profile value</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">alt</span></code>: altitude</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tdt</span></code>: time delta</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ucr</span></code>: rig-uncorrelated uncertainty</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ucs</span></code>: spatial-correlated uncertainty</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uct</span></code>: temporal-correlated uncertainty</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ucu</span></code>: true uncorrelated uncertainty</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flg</span></code>: flags</p></li>
</ul>
</div></blockquote>
<p>The following parameters are applicable to their event metadata:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">oid</span></code>: object ID, unique for profiles with the same radiosonde serial number and product ID</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">eid</span></code>: measurement event ID</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rid</span></code>: rig ID (in case of multiple flights)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mid</span></code>: the GDP model ID</p></li>
</ul>
</div></blockquote>
<p>All radiosonde profiles must be associated to a specific <code class="docutils literal notranslate"><span class="pre">event</span></code> and <code class="docutils literal notranslate"><span class="pre">rig</span></code>,
which (respectively) encode the spatial+temporal and payload configurations of the launch.
This information must be provided to dvas via <cite>tags</cite> in the metadata associated to each dataset.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>If two radiosondes are launched from the same location and at the same time, but with two
distinct balloons, they have an identical <strong>event</strong> value, but distinct <strong>rig</strong> and
<strong>object ID</strong> values.</p>
</div>
</section>
</section>
<section id="event-filtering-syntax">
<h2>Event filtering syntax<a class="headerlink" href="#event-filtering-syntax" title="Permalink to this headline"></a></h2>
<p>The following grammatic rules allow to filter and extract specific event datasets from the database:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="nb">all</span><span class="p">():</span> <span class="n">Select</span> <span class="nb">all</span>
<span class="o">-</span> <span class="p">[</span><span class="n">datetime</span><span class="o">|</span><span class="n">dt</span><span class="p">](</span><span class="s1">&#39;&lt;ISO datetime&gt;&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">(</span><span class="n">default</span><span class="p">)</span><span class="o">|</span><span class="s1">&#39;&gt;=&#39;</span><span class="o">|</span><span class="s1">&#39;&gt;&#39;</span><span class="o">|</span><span class="s1">&#39;&lt;=&#39;</span><span class="o">|</span><span class="s1">&#39;&lt;&#39;</span><span class="o">|</span><span class="s1">&#39;!=&#39;</span><span class="p">]):</span> <span class="n">Select</span> <span class="n">by</span> <span class="n">datetime</span>
<span class="o">-</span> <span class="p">[</span><span class="n">serialnumber</span><span class="o">|</span><span class="n">sn</span><span class="p">](</span><span class="s1">&#39;&lt;Serial number&gt;&#39;</span><span class="p">):</span> <span class="n">Select</span> <span class="n">by</span> <span class="n">serial</span> <span class="n">number</span>
<span class="o">-</span> <span class="p">[</span><span class="n">tag</span><span class="p">]([</span><span class="s1">&#39;&lt;Tag&gt;&#39;</span><span class="o">|</span><span class="p">(</span><span class="s1">&#39;&lt;Tag 1&gt;&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span><span class="s1">&#39;&lt;Tag n&gt;&#39;</span><span class="p">)]):</span> <span class="n">Select</span> <span class="n">by</span> <span class="n">tag</span>
<span class="o">-</span> <span class="n">and_</span><span class="p">(</span><span class="o">&lt;</span><span class="n">expr</span> <span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">expr</span> <span class="n">n</span><span class="o">&gt;</span><span class="p">):</span> <span class="n">Intersection</span>
<span class="o">-</span> <span class="n">or_</span><span class="p">(</span><span class="o">&lt;</span><span class="n">expr</span> <span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">expr</span> <span class="n">n</span><span class="o">&gt;</span><span class="p">):</span> <span class="n">Union</span>
<span class="o">-</span> <span class="n">not_</span><span class="p">(</span><span class="o">&lt;</span><span class="n">expr</span><span class="o">&gt;</span><span class="p">):</span> <span class="n">All</span> <span class="o">-</span> <span class="o">&lt;</span><span class="n">expr</span><span class="o">&gt;</span>
</pre></div>
</div>
<p class="rubric">Examples</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract all the profiles associated to the event tagged &quot;1&quot;:</span>
<span class="n">filt_evt</span> <span class="o">=</span> <span class="s2">&quot;tag(&#39;e1&#39;)&quot;</span>

<span class="c1"># Extract all the profiles from a specific launch time:</span>
<span class="n">filt_dt</span> <span class="o">=</span> <span class="s2">&quot;dt(&#39;20160715T120000Z&#39;, &#39;==&#39;)&quot;</span>

<span class="c1"># Two or more conditions can also be combined, for example:</span>
<span class="n">filt_comb</span> <span class="o">=</span> <span class="s2">&quot;and_(</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filt_evt</span><span class="p">,</span> <span class="n">filt_dt</span><span class="p">)</span>

<span class="c1"># With the suitable filter, the data can then be extracted from the database:</span>
<span class="n">data_t</span> <span class="o">=</span> <span class="n">time_mngr</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filt</span><span class="p">,</span> <span class="s1">&#39;trepros1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="plotting-tools">
<h2>Plotting tools<a class="headerlink" href="#plotting-tools" title="Permalink to this headline"></a></h2>
<p>A lot of efforts were invested in the dvas plots, with the aim to produce high quality material that
is “publication ready” out of the box. For examples, dvas plots come in two fixed widths (in inches)
of  <code class="docutils literal notranslate"><span class="pre">dvas.plots.utils.WIDTH_ONECOL</span> <span class="pre">=</span> <span class="pre">6.92</span></code> and <code class="docutils literal notranslate"><span class="pre">dvas.plots.utils.WIDTH_ONECOL</span> <span class="pre">=</span> <span class="pre">14.16</span></code>.
When scaled by 50%, these can be directly used as 1-column and 2-column plots (respectively) in
scientific articles.</p>
<p>Here’s a few things you can do as a dvas user to control the general plotting behavior of the code.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let us import the required sub-module</span>
<span class="kn">import</span> <span class="nn">dvas.plots.utils</span> <span class="k">as</span> <span class="nn">dpu</span>

<span class="c1"># You can drastically improve the look of the dvas plots by using your system-wide LaTeX</span>
<span class="c1"># distribution (which must evidently be installed properly). Use it at your own risk.</span>
<span class="n">dpu</span><span class="o">.</span><span class="n">set_mplstyle</span><span class="p">(</span><span class="s1">&#39;latex&#39;</span><span class="p">)</span>

<span class="c1"># If you want to go back to the default matplotlib LaTeX, run</span>
<span class="c1">#dpu.set_mplstyle(&#39;nolatex&#39;)</span>

<span class="c1"># You can alter the default formats the plots will be saved in via dpu.PLOT_FMTS.</span>
<span class="c1"># The defaults formats is &#39;png&#39;</span>
<span class="n">dpu</span><span class="o">.</span><span class="n">PLOT_FMTS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="s1">&#39;pdf&#39;</span><span class="p">]</span>
<span class="c1"># If you do not want to save anything, set:</span>
<span class="c1">#dpu.PLOT_FMTS = []</span>
</pre></div>
</div>
<p>Each plotting function can also be fed a series of <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> keywords arguments. The following
three will let you better control the filenames and formats of the plots generated by dvas:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fn_prefix</span> <span class="pre">(str)</span></code>: a str to which the nominal plot filename gets appended.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fn_suffix</span> <span class="pre">(str)</span></code>: a str that gets appended to the plot filename.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fmts</span> <span class="pre">(str</span> <span class="pre">or</span> <span class="pre">list</span> <span class="pre">of</span> <span class="pre">str)</span></code>: will override <code class="docutils literal notranslate"><span class="pre">dpu.PLOT_FMTS</span></code> for this one plot only.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">show_plt</span> <span class="pre">(bool)</span></code>: will override <code class="docutils literal notranslate"><span class="pre">dpu.PLOT_SHOW</span></code> to show the plot on screen (or not).</p></li>
</ul>
</div></blockquote>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="running_recipes.html" class="btn btn-neutral float-left" title="Running dvas recipes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="troubleshooting.html" class="btn btn-neutral float-right" title="Troubleshooting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2022, MeteoSwiss.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>