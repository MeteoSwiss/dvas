<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>dvas.tools.gdps package &mdash; dvas  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="dvas_recipes package" href="dvas_recipes.html" />
    <link rel="prev" title="dvas.tools.dtas package" href="dvas.tools.dtas.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> dvas
          </a>
              <div class="version">
                0.7.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running_recipes.html">Running dvas recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../creating_recipes.html">Creating dvas recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledge.html">Acknowledging dvas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License &amp; Copyright</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/MeteoSwiss-MDA/dvas/blob/develop/CONTRIBUTING.md">Contributing</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/MeteoSwiss-MDA/dvas">Github repository</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../modules.html">Modules</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="dvas.html">dvas package</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="dvas.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="dvas.config.html">dvas.config package</a></li>
<li class="toctree-l4"><a class="reference internal" href="dvas.data.html">dvas.data package</a></li>
<li class="toctree-l4"><a class="reference internal" href="dvas.database.html">dvas.database package</a></li>
<li class="toctree-l4"><a class="reference internal" href="dvas.plots.html">dvas.plots package</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="dvas.tools.html">dvas.tools package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="dvas.html#submodules">Submodules</a></li>
<li class="toctree-l3"><a class="reference internal" href="dvas.html#module-dvas.dvas">dvas.dvas module</a></li>
<li class="toctree-l3"><a class="reference internal" href="dvas.html#module-dvas.dynamic">dvas.dynamic module</a></li>
<li class="toctree-l3"><a class="reference internal" href="dvas.html#module-dvas.environ">dvas.environ module</a></li>
<li class="toctree-l3"><a class="reference internal" href="dvas.html#module-dvas.errors">dvas.errors module</a></li>
<li class="toctree-l3"><a class="reference internal" href="dvas.html#module-dvas.hardcoded">dvas.hardcoded module</a></li>
<li class="toctree-l3"><a class="reference internal" href="dvas.html#module-dvas.helper">dvas.helper module</a></li>
<li class="toctree-l3"><a class="reference internal" href="dvas.html#module-dvas.logger">dvas.logger module</a></li>
<li class="toctree-l3"><a class="reference internal" href="dvas.html#module-dvas.version">dvas.version module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dvas_recipes.html">dvas_recipes package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../doc_todo.html">Documentation todos</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">dvas</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../modules.html">Modules</a> &raquo;</li>
          <li><a href="dvas.html">dvas package</a> &raquo;</li>
          <li><a href="dvas.tools.html">dvas.tools package</a> &raquo;</li>
      <li>dvas.tools.gdps package</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/modules/dvas.tools.gdps.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-dvas.tools.gdps">
<span id="dvas-tools-gdps-package"></span><h1>dvas.tools.gdps package<a class="headerlink" href="#module-dvas.tools.gdps" title="Permalink to this heading"></a></h1>
<p>Copyright (c) 2020-2022 MeteoSwiss, contributors listed in AUTHORS.</p>
<p>Distributed under the terms of the GNU General Public License v3.0 or later.</p>
<p>SPDX-License-Identifier: GPL-3.0-or-later</p>
<p>This sub-package contains GRUAN-related tools.</p>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this heading"></a></h2>
</section>
<section id="module-dvas.tools.gdps.correlations">
<span id="dvas-tools-gdps-correlations-module"></span><h2>dvas.tools.gdps.correlations module<a class="headerlink" href="#module-dvas.tools.gdps.correlations" title="Permalink to this heading"></a></h2>
<p>Copyright (c) 2020-2022 MeteoSwiss, contributors listed in AUTHORS.</p>
<p>Distributed under the terms of the GNU General Public License v3.0 or later.</p>
<p>SPDX-License-Identifier: GPL-3.0-or-later</p>
<p>This module contains GRUAN-correlations-related utilities, including the means to compute
correlation coefficients.</p>
<dl class="py function">
<dt class="sig sig-object py" id="dvas.tools.gdps.correlations.coeffs">
<span class="sig-prename descclassname"><span class="pre">dvas.tools.gdps.correlations.</span></span><span class="sig-name descname"><span class="pre">coeffs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">j</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">oid_i</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">oid_j</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mid_i</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mid_j</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rid_i</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rid_j</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eid_i</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eid_j</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#dvas.tools.gdps.correlations.coeffs" title="Permalink to this definition"></a></dt>
<dd><p>Computes the correlation coefficient(s), for the different uncertainty types of GRUAN Data
Products (GDPs), between specific measurements.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>i</strong> (<em>numpy.ndarray of int|float</em>) – synchronized time, step, or altitude of measurement 1.</p></li>
<li><p><strong>j</strong> (<em>numpy.ndarray of int|float</em>) – synchronized time, step, or altitude of measurement 2.</p></li>
<li><p><strong>sigma_name</strong> (<em>str</em>) – uncertainty type. Must be one of [‘ucr’, ‘ucs’, ‘uct’, ‘ucu’].</p></li>
<li><p><strong>oid_i</strong> (<em>numpy.ndarray of int|str, optional</em>) – object id from measurement 1.</p></li>
<li><p><strong>oid_j</strong> (<em>numpy.ndarray of int|str, optional</em>) – object id from measurement 2.</p></li>
<li><p><strong>mid_i</strong> (<em>numpy.ndarray of int|str, optional</em>) – GDP model from measurement 1.</p></li>
<li><p><strong>mid_j</strong> (<em>numpy.ndarray of int|str, optional</em>) – GDP model from measurement 2.</p></li>
<li><p><strong>rid_i</strong> (<em>numpy.ndarray of int|str, optional</em>) – rig id of measurement 1.</p></li>
<li><p><strong>rid_j</strong> (<em>numpy.ndarray of int|str, optional</em>) – rig id of measurement 2.</p></li>
<li><p><strong>eid_i</strong> (<em>numpy.ndarray of int|str, optional</em>) – event id of measurement 1.</p></li>
<li><p><strong>eid_j</strong> (<em>numpy.ndarray of int|str, optional</em>) – event id of measurement 2.</p></li>
</ul>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<ul class="simple">
<li><p>If no oids are specified, the function will assume that the data originates
<strong>from the exact same radiosonde.</strong> Idem for the GDP models, rig id and event id.</p></li>
<li><p>The profiles are assumed to be synchronized, i.e. if specifying i and j as steps,
i=j implies that they both have the same altitude.</p></li>
</ul>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><em>numpy.ndarray of float(s)</em> – the correlation coefficient(s), in the range [0, 1].</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function returns the pair-wise correlation coefficients,
<strong>not</strong> the full correlation matrix, i.e:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">shape</span><span class="p">(</span><span class="n">corcoef_gdps</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">uc_type</span><span class="p">))</span> <span class="o">==</span> <span class="n">shape</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">shape</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The supported uncertainty types are:</p>
<ul class="simple">
<li><dl class="simple">
<dt>‘ucr’: rig-correlated uncertainty.</dt><dd><p>Intended for the so-called “uncorrelated” GRUAN uncertainty.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>‘ucs’: spatial-correlated uncertainty.</dt><dd><p>Full correlation between measurements acquired during the same event at the same site,
irrespective of the time step/altitude, rig, radiosonde model, or serial number.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>‘uct’: temporal-correlated uncertainty.</dt><dd><p>Full correlation between measurements acquired at distinct sites during distinct
events, with distinct radiosondes models and serial numbers.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>‘ucu’: uncorrelated.</dt><dd><p>No correlation whatsoever between distinct measurements.</p>
</dd>
</dl>
</li>
</ul>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<ul class="simple">
<li><p>Add reference to GRUAN docs &amp; dvas articles in this docstring.</p></li>
</ul>
</div>
</dd></dl>

</section>
<section id="module-dvas.tools.gdps.gdps">
<span id="dvas-tools-gdps-gdps-module"></span><h2>dvas.tools.gdps.gdps module<a class="headerlink" href="#module-dvas.tools.gdps.gdps" title="Permalink to this heading"></a></h2>
<p>Copyright (c) 2020-2022 MeteoSwiss, contributors listed in AUTHORS.</p>
<p>Distributed under the terms of the GNU General Public License v3.0 or later.</p>
<p>SPDX-License-Identifier: GPL-3.0-or-later</p>
<p>This module contains GRUAN-related routines, including correlation rules for GDP uncertainties.</p>
<dl class="py function">
<dt class="sig sig-object py" id="dvas.tools.gdps.gdps.combine">
<span class="sig-prename descclassname"><span class="pre">dvas.tools.gdps.gdps.</span></span><span class="sig-name descname"><span class="pre">combine</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gdp_prfs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">binning</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'weighted</span> <span class="pre">mean'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask_flgs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chunk_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">150</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_cpus</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#dvas.tools.gdps.gdps.combine" title="Permalink to this definition"></a></dt>
<dd><p>Combines and (possibly) rebins GDP profiles, with full error propagation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function requires profiles that have been resampled (if applicable) and synchronized
beforehand. This implies that the <cite>_idx</cite> index must be identical for all Profiles.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gdp_profs</strong> (<em>dvas.data.data.MultiGDPProfile</em>) – synchronized GDP profiles to combine.</p></li>
<li><p><strong>binning</strong> (<em>int, optional</em>) – the number of profile steps to put into a bin. Defaults to 1.</p></li>
<li><p><strong>method</strong> (<em>str, optional</em>) – combination rule. Can be one of
[‘weighted mean’, ‘mean’, or ‘delta’]. Defaults to ‘weighted mean’.</p></li>
<li><p><strong>mask_flgs</strong> (<em>str|list of str, optional</em>) – (list of) flag(s) to ignore when combining profiles.</p></li>
<li><p><strong>chunk_size</strong> (<em>int, optional</em>) – to speed up computation, Profiles get broken up in chunks of
that length. The larger the chunks, the larger the memory requirements. The smaller the
chunks the more items to process. Defaults to 150.</p></li>
<li><p><strong>n_cpus</strong> (<em>int|str, optional</em>) – number of cpus to use. Can be a number, or ‘max’. Set to 1 to
disable multiprocessing. Defaults to 1.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p><em>(dvas.data.data.MultiCWSProfile, dict)</em> –</p>
<dl class="simple">
<dt>the combined working standard profile, and the</dt><dd><p>a dictionnary with the full covariance matrices for the different uncertainty types.</p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-dvas.tools.gdps.stats">
<span id="dvas-tools-gdps-stats-module"></span><h2>dvas.tools.gdps.stats module<a class="headerlink" href="#module-dvas.tools.gdps.stats" title="Permalink to this heading"></a></h2>
<p>Copyright (c) 2020-2022 MeteoSwiss, contributors listed in AUTHORS.</p>
<p>Distributed under the terms of the GNU General Public License v3.0 or later.</p>
<p>SPDX-License-Identifier: GPL-3.0-or-later</p>
<p>This module contains statistical routines and tools for handling GDPs.</p>
<dl class="py function">
<dt class="sig sig-object py" id="dvas.tools.gdps.stats.ks_test">
<span class="sig-prename descclassname"><span class="pre">dvas.tools.gdps.stats.</span></span><span class="sig-name descname"><span class="pre">ks_test</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gdp_pair</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0027</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">m_val</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#dvas.tools.gdps.stats.ks_test" title="Permalink to this definition"></a></dt>
<dd><p>Runs a <code class="docutils literal notranslate"><span class="pre">scipy.stats.kstest()</span></code> two-sided test on the normalized-delta between two
GDPProfile instances, against a normal distribution.</p>
<p>The KS test is being run on a level-per-level basis.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See the dvas documentation for more details about the scientific motivation for this
function.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gdp_pair</strong> (<em>list of dvas.data.strategy.data.GDPProfile</em>) – GDP Profiles to compare.</p></li>
<li><p><strong>alpha</strong> (<em>float, optional</em>) – The significance level for the KS test. Must be 0&lt;alpha&lt;1.
Defaults to 0.27%=0.0027.</p></li>
<li><p><strong>m_val</strong> (<em>int, optional</em>) – Binning strength for the Profile delta (Important: the binning is
performed before running the KS test). Defaults to 1 (=no binning).</p></li>
<li><p><strong>**kwargs</strong> – mask_flgs and/or n_cpus and/or chunk_size, that will get fed to
dvas.tools.gdps.gdps.combine().</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p><em>pandas DataFrame</em> – a DataFrame containing Delta_pqei, sigma_pqei, k_pqei, pks_pqei, and
f_pqei values:</p>
<blockquote>
<div><ul class="simple">
<li><p>Delta_pqei is the (binned) profile delta with sigma_pqei its (total) uncertainty,</p></li>
<li><p>k_pqei=Delta_pqei/sigma_pqei is the (binned) profile delta normalized by the total
uncertainty,</p></li>
<li><p>pks_pqei contains the corresponding p-value from the KS test, and</p></li>
<li><p>f_pqi contains 1 where the KS test failed, and 0 otherwise.
That is: 1 &lt;=&gt; the p-value of the KS test is &lt;= alpha.</p></li>
</ul>
</div></blockquote>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="dvas.tools.gdps.stats.gdp_incompatibilities">
<span class="sig-prename descclassname"><span class="pre">dvas.tools.gdps.stats.</span></span><span class="sig-name descname"><span class="pre">gdp_incompatibilities</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gdp_prfs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0027</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">m_vals</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rolling</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fn_prefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fn_suffix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#dvas.tools.gdps.stats.gdp_incompatibilities" title="Permalink to this definition"></a></dt>
<dd><p>Runs a series of KS tests to assess the consistency of several GDP profiles.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gdp_prfs</strong> (<em>dvas.data.data.MultiGDPProfile</em>) – synchronized GDP profiles to check.</p></li>
<li><p><strong>alpha</strong> (<em>float, optional</em>) – The significance level for the KS test. Defaults to 0.27%</p></li>
<li><p><strong>m_vals</strong> (<em>ndarray of int, optional</em>) – The rolling binning sizes “m”. Defaults to None==[1].</p></li>
<li><p><strong>rolling</strong> (<em>bool, optional</em>) – if True and len(m_vals)&gt;1, any incompatibility found
for a specific m value will be forwarded to the subsequent ones. Else, each m value
is treated independantly. Defaults to True. If rolling is True, the order of the
m_vals list thus matters.</p></li>
<li><p><strong>do_plot</strong> (<em>bool, optional</em>) – Whether to create the diagnostic plot, or not. Defaults to False.</p></li>
<li><p><strong>fn_prefix</strong> (<em>str, optional</em>) – if set, the prefix of the plot filename.</p></li>
<li><p><strong>fn_suffix</strong> (<em>str, optional</em>) – if set, the suffix of the plot filename.</p></li>
<li><p><strong>**kwargs</strong> – n_cpus and/or chunk_size, that will get fed to dvas.tools.gdps.gdps.combine().</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p><em>pd.DataFrame</em> – the values of Delta_pqei, sigma_pqei, k_pqei, pks_pqei and f_pqei for each
pair of GDPs and each m value.</p>
<p>GDP pairs are identified using their oids, as: <cite>oid_1_vs_oid_2</cite>.</p>
<p>f_pqei==1 indicates that the p-value of the KS test is &lt;= alpha for this measurement,
i.e. that the profiles are incompatible.</p>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="dvas.tools.gdps.stats.gdp_validities">
<span class="sig-prename descclassname"><span class="pre">dvas.tools.gdps.stats.</span></span><span class="sig-name descname"><span class="pre">gdp_validities</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">incompat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">m_vals</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strategy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'all-or-none'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#dvas.tools.gdps.stats.gdp_validities" title="Permalink to this definition"></a></dt>
<dd><p>Given GDP incompatibilities, identifies valid measurements (suitable for the assembly of a
combined working standard) given a specific combination strategy.</p>
<dl class="simple">
<dt>Valid strategies include:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>‘all-or-none’: either all GDP measurements from a certain bin are compatible with each</dt><dd><p>others, or all of them are dropped.</p>
</dd>
</dl>
</li>
<li><p>‘force-all-valid’: combine all GDPs, irrespective of the reported incompatibilities.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>incompat</strong> (<em>dict</em>) – outcome of dvas.tools.gdps.stats.gdp_incompatibilities().</p></li>
<li><p><strong>m_vals</strong> (<em>list of int, oprtional</em>) – list of m values to take into account when checking
incompatibilities. Defaults to None = [1].</p></li>
<li><p><strong>strategy</strong> (<em>str, optional</em>) – name of a validation strategy. Defaults to ‘all-or-none’.</p></li>
</ul>
</dd>
</dl>
<p>Returns:</p>
</dd></dl>

</section>
<section id="module-dvas.tools.gdps.utils">
<span id="dvas-tools-gdps-utils-module"></span><h2>dvas.tools.gdps.utils module<a class="headerlink" href="#module-dvas.tools.gdps.utils" title="Permalink to this heading"></a></h2>
<p>Copyright (c) 2020-2022 MeteoSwiss, contributors listed in AUTHORS.</p>
<p>Distributed under the terms of the GNU General Public License v3.0 or later.</p>
<p>SPDX-License-Identifier: GPL-3.0-or-later</p>
<p>This module contains GRUAN-related utilities.</p>
<dl class="py function">
<dt class="sig sig-object py" id="dvas.tools.gdps.utils.weighted_mean">
<span class="sig-prename descclassname"><span class="pre">dvas.tools.gdps.utils.</span></span><span class="sig-name descname"><span class="pre">weighted_mean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df_chunk</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">binning</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#dvas.tools.gdps.utils.weighted_mean" title="Permalink to this definition"></a></dt>
<dd><p>Compute the (respective) weighted mean of the ‘tdt’, ‘val’, and ‘alt’ columns of a
pd.DataFrame, with weights defined in the ‘w_ps’ column. Also returns the Jacobian matrix for
<cite>val</cite> to enable accurate error propagation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The input format for <cite>df_chunk</cite> is a <cite>pandas.DataFrame</cite> with a very specific structure.
It requires a single index called <cite>_idx</cite>, with 5 columns per profiles with labels <cite>tdt</cite>,
<cite>alt</cite>, <cite>val</cite>, ‘flg’, and <cite>w_ps</cite>. All these must be grouped together using pd.MultiIndex
where the level 0 corresponds to the profile number (e.g. 0, 1, 2…), and the level 1 is
the original column name, i.e.:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span>           <span class="mi">0</span>                                        <span class="mi">1</span>
         <span class="n">alt</span>              <span class="n">tdt</span>    <span class="n">val</span>  <span class="n">flg</span>  <span class="n">w_ps</span>   <span class="n">alt</span>  <span class="o">...</span> <span class="n">w_ps</span>
<span class="n">_idx</span>
<span class="mi">0</span>      <span class="mf">486.7</span>  <span class="mi">0</span> <span class="n">days</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">284.7</span>    <span class="mi">0</span>  <span class="mf">55.8</span>  <span class="mf">485.9</span> <span class="o">...</span> <span class="mf">22.4</span>
<span class="mi">1</span>      <span class="mf">492.4</span>  <span class="mi">0</span> <span class="n">days</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span>  <span class="mf">284.6</span>    <span class="mi">1</span>  <span class="mf">67.5</span>  <span class="mf">493.4</span> <span class="o">...</span> <span class="mf">26.3</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df_chunk</strong> (<em>pandas.DataFrame</em>) – data conatining the Profiles to merge.</p></li>
<li><p><strong>binning</strong> (<em>int, optional</em>) – binning size. Defaults to 1 (=no binning).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><em>(pandas.DataFrame, np.ma.masked_array)</em> – weighted mean profile, and associated Jacobian
matrix. The matrix has a size of m * n, with m = len(df_chunk)/binning, and
n = len(df_chunk) * n_profile.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The function will ignore NaNs in a given bin, unless <em>all</em> the values in the bin are NaNs.
See fancy_nansum() for details.</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="dvas.tools.gdps.utils.delta">
<span class="sig-prename descclassname"><span class="pre">dvas.tools.gdps.utils.</span></span><span class="sig-name descname"><span class="pre">delta</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df_chunk</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">binning</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#dvas.tools.gdps.utils.delta" title="Permalink to this definition"></a></dt>
<dd><p>Compute the delta of the ‘tdt’, ‘val’, and ‘alt’ columns of a pd.DataFrame containing
exactly 2 Profiles. Also returns the Jacobian matrix for <cite>val</cite> to enable accurate error
propagation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The input format for <cite>df_chunk</cite> is a <cite>pandas.DataFrame</cite> with a very specific structure.
It requires a single index called <cite>_idx</cite>, with 4 columns per profiles with labels <cite>tdt</cite>,
<cite>alt</cite>, <cite>val</cite>, and ‘flg’. All these must be grouped together using pd.MultiIndex where the
level 0 corresponds to the profile number (i.e. 0 or 1), and the level 1 is the original
column name, i.e.:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span>           <span class="mi">0</span>                               <span class="mi">1</span>
         <span class="n">alt</span>              <span class="n">tdt</span>    <span class="n">val</span> <span class="n">flg</span> <span class="n">alt</span>    <span class="o">...</span>  <span class="n">flg</span>
<span class="n">_idx</span>
<span class="mi">0</span>      <span class="mf">486.7</span>  <span class="mi">0</span> <span class="n">days</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">284.7</span>   <span class="mi">0</span> <span class="mf">486.5</span>  <span class="o">...</span>    <span class="mi">0</span>
<span class="mi">1</span>      <span class="mf">492.4</span>  <span class="mi">0</span> <span class="n">days</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span>  <span class="mf">284.6</span>   <span class="mi">0</span> <span class="mf">491.9</span>  <span class="o">...</span>    <span class="mi">1</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df_chunk</strong> (<em>pandas.DataFrame</em>) – data containing the Profiles to merge.</p></li>
<li><p><strong>binning</strong> (<em>int, optional</em>) – binning size. Defaults to 1 (=no binning).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><em>(pandas.DataFrame, np.ma.masked_array)</em> – delta profile (1 - 0), and associated Jacobian
matrix. The matrix has a size of m * n, with m = len(df_chunk)/binning, and
n = len(df_chunk) * 2.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The function will ignore NaNs in a given bin, unless <em>all</em> the values in the bin are NaNs.
See fancy_nansum() for details.</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="dvas.tools.gdps.utils.process_chunk">
<span class="sig-prename descclassname"><span class="pre">dvas.tools.gdps.utils.</span></span><span class="sig-name descname"><span class="pre">process_chunk</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df_chunk</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">binning</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'weighted</span> <span class="pre">mean'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#dvas.tools.gdps.utils.process_chunk" title="Permalink to this definition"></a></dt>
<dd><p>Process a DataFrame chunk and propagate the errors.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The input format for <cite>df_chunk</cite> is a <cite>pandas.DataFrame</cite> with a very specific structure.
It requires a single index called <cite>_idx</cite>, with 13 columns per profiles with labels <cite>tdt</cite>,
<cite>alt</cite>, <cite>val</cite>, ‘flg’, <cite>ucr</cite>, <cite>ucs</cite>, <cite>uct</cite>, <cite>ucu</cite>, <cite>uc_tot</cite>, <cite>oid</cite>, <cite>mid</cite>, <cite>eid</cite>, and <cite>rid</cite>.
All these must be grouped together using pd.MultiIndex where the level 0 corresponds
to the profile number (e.g. 0,1,2…), and the level 1 is the original column name, i.e.:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span>           <span class="mi">0</span>                                                <span class="mi">1</span>
         <span class="n">alt</span>              <span class="n">tdt</span>    <span class="n">val</span>   <span class="n">ucr</span> <span class="n">ucs</span>  <span class="o">...</span>   <span class="n">rid</span> <span class="n">alt</span> <span class="o">...</span>
<span class="n">_idx</span>
<span class="mi">0</span>      <span class="mf">486.7</span>  <span class="mi">0</span> <span class="n">days</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">284.7</span>   <span class="n">NaN</span> <span class="n">NaN</span>  <span class="o">...</span>     <span class="mi">1</span> <span class="mf">485.8</span>
<span class="mi">1</span>      <span class="mf">492.4</span>  <span class="mi">0</span> <span class="n">days</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span>  <span class="mf">284.6</span>  <span class="mf">0.07</span> <span class="n">NaN</span>  <span class="o">...</span>     <span class="mi">1</span> <span class="mf">493.4</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df_chunk</strong> (<em>pandas.DataFrame</em>) – data containing the Profiles to merge.</p></li>
<li><p><strong>binning</strong> (<em>int, optional</em>) – binning size. Defaults to 1 (=no binning).</p></li>
<li><p><strong>method</strong> (<em>str, optional</em>) – the processing method. Can be one of
[‘mean’, ‘weighted mean’, delta’]. Defaults to ‘weighted mean’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p><em>pandas.DataFrame, dict</em> –</p>
<dl class="simple">
<dt>the processing outcome, including all the errors,</dt><dd><p>and the full correlation matrices (one per uncertainty type) as a dict.</p>
</dd>
</dl>
</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The function will ignore NaNs in a given bin, unless <em>all</em> the values in the bin are NaNs.
See fancy_nansum() for details.</p>
</div>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="dvas.tools.dtas.html" class="btn btn-neutral float-left" title="dvas.tools.dtas package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="dvas_recipes.html" class="btn btn-neutral float-right" title="dvas_recipes package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2022, MeteoSwiss.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>